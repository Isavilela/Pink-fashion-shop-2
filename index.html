<!doctype html>
<div class="meta">
<div>
<div class="title">${p.title}</div>
<div class="muted" style="font-size:13px">${p.cat}</div>
</div>
<div style="text-align:right">
<div class="price">${formatPrice(p.price)}</div>
<div style="margin-top:8px;display:flex;gap:8px;justify-content:flex-end">
<button class="badge" onclick="openModal(${p.id})">Visualizar</button>
<button class="btn" onclick="addToCart(${p.id})">Adicionar</button>
</div>
</div>
</div>`;
grid.appendChild(div);
});
}


function filterAndRender(){
const q = (searchInput.value||'').toLowerCase();
const cat = category.value;
let out = products.filter(p => (cat==='all' || p.cat===cat) && (p.title.toLowerCase().includes(q) || p.desc.toLowerCase().includes(q)));
const s = sort.value;
if(s==='price-asc') out.sort((a,b)=>a.price-b.price);
if(s==='price-desc') out.sort((a,b)=>b.price-a.price);
renderProducts(out);
}


searchInput.addEventListener('input', filterAndRender);
category.addEventListener('change', filterAndRender);
sort.addEventListener('change', filterAndRender);


// Modal
const modal = document.getElementById('modal');
function openModal(id){
const p = products.find(x=>x.id===id);
if(!p) return;
modalProductId = id;
document.getElementById('modalImg').src = p.img;
document.getElementById('modalTitle').textContent = p.title;
document.getElementById('modalDesc').textContent = p.desc;
document.getElementById('modalPrice').textContent = formatPrice(p.price);
modal.classList.add('show');
modal.setAttribute('aria-hidden','false');
}
function closeModal(){ modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); }
modal.addEventListener('click', (e)=>{ if(e.target===modal) closeModal(); });


// Cart
function addToCart(id){
const p = products.find(x=>x.id===id);
if(!p) return;
const found = cart.find(i=>i.id===id);
if(found) found.qty++;
else cart.push({id:p.id,title:p.title,price:p.price,qty:1});
updateCartUI();
alert('Adicionado ao carrinho: '+p.title);
}
function updateCartUI(){
const count = cart.reduce((s,i)=>s+i.qty,0);
openCartBtn.textContent = `Carrinho (${count})`;
}
openCartBtn.addEventListener('click', ()=>{
if(cart.length===0) alert('Seu carrinho está vazio.');
else{
let text = 'Carrinho:\n';
cart.forEach(it=> text += `${it.title} — ${it.qty}x — ${formatPrice(it.price*it.qty)}\n`);
text += '\nTotal: ' + formatPrice(cart.reduce((s,i)=>s+i.qty*i.price,0));
alert(text);
}
});


// init
document.getElementById('year').textContent = new Date().getFullYear();
filterAndRender();
</script>
</body>
</html>
